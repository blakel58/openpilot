<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>comma body</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"/>
  <link rel="stylesheet" href="/static/main.css" />
</head>
<body>
  <div id="main" class="container-fluid p-3 text-white">
    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h1 class="fs-4 mb-0">comma body</h1>
      <div class="d-flex gap-3 align-items-center">
        <div class="badge bg-dark text-white d-flex align-items-center gap-2 px-3 py-2">
          <span id="connection-dot" class="rounded-circle bg-danger" style="width:10px;height:10px;"></span>
          <span id="connection-text">Disconnected</span>
        </div>
        <div class="status-info"><i class="bi bi-arrow-repeat me-1"></i> <span id="ping-time">--</span></div>
        <div class="status-info"><i class="bi bi-battery-half me-1"></i> <span id="battery">--</span></div>
      </div>
    </div>

    <!-- Cameras -->
    <div class="row g-3">
      <!-- Previews (stacked vertically) -->
      <div class="col-3 d-flex flex-column gap-2">
        <div class="preview-card selected" data-camera="driver">
          <video id="driver-video" class="w-100" muted playsinline loop></video>
          <div class="preview-label">Driver</div>
        </div>
        <div class="preview-card" data-camera="road">
          <video id="road-video" class="w-100" muted playsinline loop></video>
          <div class="preview-label">Road</div>
        </div>
        <div class="preview-card" data-camera="wideRoad">
          <video id="wideRoad-video" class="w-100" muted playsinline loop></video>
          <div class="preview-label">Wide Road</div>
        </div>
      </div>

      <!-- Main Video -->
      <div class="col-9">
        <div class="main-video rounded-3 overflow-hidden">
          <video id="main-video" class="w-100" autoplay muted playsinline loop></video>
        </div>
      </div>
    </div>

    <!-- Controls Section -->
    <div class="row g-3 mt-3">
      <!-- WASD -->
      <div class="col-md-6">
        <div class="card bg-dark p-3">
          <div class="wasd-grid mx-auto">
            <button id="key-w" class="wasd-btn">W</button>
            <div id="key-val" class="position-display">
              <span id="pos-vals">0,0</span>
              <small>x,y</small>
            </div>
            <button id="key-a" class="wasd-btn">A</button>
            <button id="key-s" class="wasd-btn">S</button>
            <button id="key-d" class="wasd-btn">D</button>
          </div>
        </div>
      </div>

      <!-- Plan Input -->
      <div class="col-md-6">
        <div class="card bg-dark p-3">
          <label class="form-label mb-1">Movement Plan</label>
          <textarea id="plan-text" rows="3" class="form-control bg-dark text-white mb-2" placeholder="1,0,0,1,2"></textarea>
          <button id="plan-button" class="btn btn-primary w-100">Execute Plan</button>
        </div>
      </div>
    </div>

    <!-- Sounds -->
    <div class="card bg-dark p-3 mt-3">
      <div class="d-flex flex-wrap gap-2 align-items-center">
        <span class="me-3 fw-semibold">Play System Sounds:</span>
        <button id="sound-engage" class="btn btn-outline-success">Engage</button>
        <button id="sound-disengage" class="btn btn-outline-warning">Disengage</button>
        <button id="sound-error" class="btn btn-outline-danger">Error</button>
      </div>
    </div>
  </div>

  <script>
    document.querySelectorAll('.preview-card').forEach(card => {
      card.addEventListener('click', () => {
        document.querySelectorAll('.preview-card').forEach(c => c.classList.remove('selected'));
        card.classList.add('selected');
        const cam = card.dataset.camera;
        const main = document.getElementById('main-video');
        const selectedVideo = document.getElementById(`${cam}-video`);
        if (selectedVideo && main) main.srcObject = selectedVideo.srcObject;
      });
    });

    function setConnectionStatus(connected) {
      const dot = document.getElementById('connection-dot');
      const text = document.getElementById('connection-text');
      dot.className = connected ? 'bg-success rounded-circle' : 'bg-danger rounded-circle';
      text.textContent = connected ? 'Connected' : 'Disconnected';
    }
  </script>
</body>
</html>
